<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Build Sheet</title>

  <!-- ===================== THEME & LAYOUT (CSS) ===================== -->
  <style>
    /* ---------- Root Theme Variables ---------- */
    :root {
      --bg: #0b0f1a;               /* page background */
      --panel: rgba(255,255,255,0.06); /* card panels */
      --text: #e6e9ef;             /* default text color */
      --muted: #aab2c0;            /* muted text */
      --accent: #7c5cff;           /* purple accent */
      --accent-2: #00d1ff;         /* cyan accent */
      --radius: 16px;              /* card radius */
      --shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      --warn: #ff6b6b;
      --good: #22c55e;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0; color: var(--text); font-family: var(--sans);
      background: radial-gradient(1000px 600px at 20% -10%, rgba(124,92,255,0.25), transparent 60%),
                  radial-gradient(700px 500px at 100% 0%, rgba(0,209,255,0.18), transparent 50%),
                  linear-gradient(180deg, #05070d, var(--bg));
    }

    a { color: var(--accent-2); text-decoration: none; }

    .wrap { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    header { display:flex; align-items:center; justify-content:space-between; gap: 16px; margin-bottom: 14px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: var(--shadow); }
    h1 { margin:0; font-size: 22px; color: var(--text); }

    .nav { display:flex; gap:10px; flex-wrap:wrap; margin-bottom: 22px; }
    .nav a { padding: 8px 12px; border-radius: 10px; border:1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); color: #fff; }
    .nav a.active { background: linear-gradient(135deg, var(--accent), var(--accent-2)); border-color: transparent; }

    .card { background: var(--panel); border: 1px solid rgba(255,255,255,0.08); border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: saturate(120%) blur(8px); }
    .card h2 { margin:0; padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,0.08); }
    .card .content { padding: 16px; background-color: #0b0f1a; }

    .grid { display:grid; grid-template-columns: 1.05fr 0.95fr; gap: 20px; }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }

    .field { display:grid; grid-template-columns: 180px 1fr; gap: 12px; align-items:center; margin: 10px 0; }
    .field label { color:var(--muted); font-size: 13px; }
    .field input, .field select, .field textarea {
      width: 100%; padding: 10px 12px; color: var(--text);
      background: #141a26; border: 1px solid rgba(255,255,255,0.12);
      border-radius: 12px; outline: none;
    }
    .field input:focus, .field select:focus, .field textarea:focus { border-color: var(--accent-2); }
    select#dc { background-color: #111522; color: #ffffff; }
    option { background-color: #0d1018; color: #ffffff; }

    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn {
      border: 1px solid rgba(255,255,255,0.18);
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
      padding: 10px 14px; border-radius: 12px; color: var(--text); cursor:pointer;
    }
    .btn.primary { border-color: transparent; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#fff; }
    .btn.link { background: transparent; border: 1px dashed rgba(255,255,255,0.2); }
    .btn:hover { transform: translateY(-1px); }

    .kv { display:grid; grid-template-columns: 120px 1fr; gap: 8px 12px; margin-top: 8px; }
    .kv .k { color: var(--muted); }
    .kv .v {
      padding: 6px 10px; background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; font-family: var(--mono);
    }

    .page { display:none; background-color: #0b0f1a; }
    .page.active { display:block; }

    .tabs { display:flex; gap: 8px; padding: 12px 12px 0; border-bottom: 1px solid rgba(255,255,255,0.08); flex-wrap: wrap; }
    .tab { padding: 8px 12px; border-radius: 10px; cursor: pointer; font-size: 13px; color: var(--muted); border: 1px solid transparent; }
    .tab.active { color: white; border-color: rgba(255,255,255,0.14); background: rgba(255,255,255,0.06); }

    .code {
      background:#0a0e18; color:#dbe2f1; border:1px solid rgba(255,255,255,0.1);
      border-radius:12px; font-family:var(--mono);
      padding:14px; white-space:pre; overflow:auto; font-size:13px;
    }
    .copyRow { display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }

    #staticOut { min-height: 200px; max-height: none; overflow: visible !important; white-space: pre-wrap; }

    .banner {
      margin: 10px 0; padding: 14px;
      border-radius: 14px; border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06); text-align:center;
      font-size: 22px; font-weight: 700; letter-spacing: .3px; display:none;
    }

    .note {
      border:1px dashed rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.05);
      border-radius: 14px; padding: 12px 14px; color: #dbe2f1;
    }

    .warn { color: var(--warn); font-weight: 800; }

    /* Inline debug banner */
    #debugBanner {
      position: fixed; bottom: 12px; right: 12px;
      background: rgba(20,27,40,0.95);
      border:1px solid rgba(255,255,255,0.12);
      padding:10px 12px; border-radius:10px;
      font-size:12px; color:#cbd5e1; z-index:9999; display:none;
    }
    #debugBanner.ok { display:block; border-color: rgba(34,197,94,0.35); color:#dcfce7; }
    #debugBanner.err { display:block; border-color: rgba(255,107,107,0.45); color:#ffe4e6; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Customer Build Sheet</h1>
      </div>
      <div class="row">
        <button class="btn" id="btnReset">Reset</button>
        <button class="btn primary" id="btnSample">Load Sample</button>
        <button class="btn" id="btnExport" title="Export form data to JSON">Export</button>
        <button class="btn" id="btnImport" title="Import JSON into form">Import</button>
        <input type="file" id="fileImport" accept="application/json,.json" style="display:none" />
      </div>
    </header>

    <nav class="nav" id="topnav">
      <a href="#home" data-route>Home</a>
      <a href="#arista" data-route>Page 1: Arista's</a>
      <a href="#dcnm" data-route>Page 2: DCNM</a>
      <a href="#localin" data-route>Page 3: Local-In Policy Golden Config</a>
      <a href="#future" data-route>Page 4: VDC Build</a>
    </nav>

    <!-- ===================== PAGE: HOME ===================== -->
    <section id="page-home" class="page active">
      <div class="card" style="margin-bottom:14px;">
        <h2>How to Use</h2>
        <div class="content">
          <ol>
            <li>Enter Customer, Salesforce ID, Datacenter, VLANs, and IPAM Public IP (CIDR).</li>
            <li>Switch to <strong>Page 1: Arista's</strong> to copy CLI outputs, or use the Static Route helper.</li>
            <li>For Dallas, see <strong>Page 2: DCNM</strong>. For Local-In policy, use <strong>Page 3</strong>. For VDC, use <strong>Page 4</strong>.</li>
          </ol>
          <div class="note" style="margin-top:10px;">
            This build sheet is meant to be used as a helping tool for keeping all of your Build info in a singular spot which makes it more efficient. It's a live tool and subject to frequent changes.
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Inputs</h2>
        <div class="content" id="formArea">
          <div class="field">
            <label for="custName">Customer Name</label>
            <input id="custName" placeholder="Acme Corp" />
          </div>
          <div class="field">
            <label for="sfid">Salesforce ID</label>
            <input id="sfid" placeholder="006XXXXXXXXXXXX" />
          </div>
          <div class="field">
            <label for="dc">Datacenter</label>
            <select id="dc">
              <option value="">Select…</option>
              <option>LAX</option><option>IAD</option><option>ORD</option>
              <option>DAL</option><option>HNK</option><option>LND</option><option>SIN</option>
            </select>
          </div>
          <div class="field">
            <label for="wanVlan">WAN VLAN</label>
            <input id="wanVlan" inputmode="numeric" placeholder="200" />
          </div>
          <div class="field">
            <label></label>
            <div class="muted">WAN Name → <span id="wanNamePreview">(auto)</span></div>
          </div>
          <div class="field">
            <label for="vcgVlan">VCG VLAN</label>
            <input id="vcgVlan" inputmode="numeric" placeholder="210" />
          </div>
          <div class="field">
            <label></label>
            <div class="muted">VCG Name → <span id="vcgNamePreview">(auto)</span></div>
          </div>
          <div class="field">
            <label for="cidr">IPAM Public IP (CIDR)</label>
            <input id="cidr" placeholder="198.51.100.32/28" />
          </div>

          <div class="kv" id="ipamSummary">
            <div class="k">Gateway:</div><div class="v"><span id="gw">—</span></div>
            <div class="k">Firewall:</div><div class="v"><span id="fw">—</span></div>
            <div class="k">Mask:</div><div class="v"><span id="mask">—</span></div>
            <div class="k">Desc:</div><div class="v"><span id="desc">—</span></div>
            <div class="k">WAN VLAN:</div><div class="v"><span id="kvWanVlan">—</span></div>
            <div class="k">Datacenter:</div><div class="v"><span id="kvDc">—</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== PAGE: ARISTA ===================== -->
    <section id="page-arista" class="page">
      <div class="grid">
        <section class="card">
          <h2>Outputs (Arista)</h2>
          <div class="tabs" role="tablist">
            <div class="tab active" data-tab="all">All</div>
            <div class="tab" data-tab="wanvlan">WAN VLAN</div>
            <div class="tab" data-tab="vcgvlan">VCG VLAN</div>
            <div class="tab" data-tab="route">Route</div>
            <div class="tab" data-tab="bgp">BGP SVC Leaves 01–04</div>
          </div>
          <div class="content">
            <div id="dalBanner" class="banner">Go to DCNM!</div>
            <div id="sec-all">
              <pre class="code" id="code-all"></pre>
              <div class="copyRow"><button class="btn" data-copy="code-all">Copy All</button></div>
            </div>
            <div id="sec-wanvlan" style="display:none;">
              <pre class="code" id="code-wanvlan"></pre>
              <div class="copyRow"><button class="btn" data-copy="code-wanvlan">Copy</button></div>
            </div>
            <div id="sec-vcgvlan" style="display:none;">
              <pre class="code" id="code-vcgvlan"></pre>
              <div class="copyRow"><button class="btn" data-copy="code-vcgvlan">Copy</button></div>
            </div>
            <div id="sec-route" style="display:none;">
              <pre class="code" id="code-route"></pre>
              <div class="copyRow"><button class="btn" data-copy="code-route">Copy</button></div>
            </div>
            <div id="sec-bgp" style="display:none;">
              <pre class="code" id="code-bgp"></pre>
              <div class="copyRow"><button class="btn" data-copy="code-bgp">Copy</button></div>
              <div id="dontforget" style="display:none; margin-top:14px;">
                <div class="sectionTitle">Don't Forget!! (IAD only)</div>
                <pre class="code" id="code-bgp-vcg"></pre>
                <div class="copyRow"><button class="btn" data-copy="code-bgp-vcg">Copy</button></div>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <h2>Static Route Helper</h2>
          <div class="content">
            <p class="muted" style="margin-top:0;">Only use <strong>/32</strong> for customer static routes.</p>
            <div id="staticRoutes">
              <div class="field static-row">
                <label>Route #1</label>
                <input class="static-route" placeholder="203.0.113.10/32" />
              </div>
            </div>
            <div class="row">
              <button class="btn" id="btnAddRoute">Add another static</button>
              <button class="btn primary" id="btnNeedStatic">Build static routes</button>
            </div>
            <div class="field" style="margin-top:12px;">
              <label>Output</label>
              <pre class="code" id="staticOut"></pre>
            </div>
            <div class="copyRow"><button class="btn" data-copy="staticOut">Copy Static Route(s)</button></div>
            <div class="muted">
              Format: <code>ip route vrf RS-INET &lt;static&gt; &lt;FirewallIP&gt; tag 10 name &lt;Customer&gt;-addtl</code>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- ===================== PAGE: DCNM ===================== -->
    <section id="page-dcnm" class="page">
      <div class="card">
        <h2>DCNM – Add Network (Dallas)</h2>
        <div class="content">
          <p class="muted">Log into DCNM – <strong>https://dal01dcnm01.rapidscale.local/</strong></p>
          <ol>
            <li>Control → Networks</li>
            <li>Filter (funnel), search WAN VLAN under VLAN ID to ensure no duplicate.</li>
            <li>Click ＋ (Create) if none exists.</li>
          </ol>

          <section class="card" style="margin-top:8px; background-color:#0b0f1a;">
            <h2>Network Information</h2>
            <div class="content">
              <pre class="code" id="dcnm-netinfo"></pre>
              <div class="copyRow"><button class="btn" data-copy="dcnm-netinfo">Copy</button></div>
            </div>
          </section>

          <section class="card" style="margin-top:8px; background-color:#0b0f1a;">
            <h2>Network Profile</h2>
            <div class="content">
              <pre class="code" id="dcnm-netprofile"></pre>
              <div class="copyRow"><button class="btn" data-copy="dcnm-netprofile">Copy</button></div>
              <div id="vlanNameWarning" class="warn" style="display:none; margin-top:8px;">
                VLAN Name has been shortened due to DCNM Constraints
              </div>
            </div>
          </section>

          <section class="card" style="margin-top:8px; background-color:#0b0f1a;">
            <h2>Advanced</h2>
            <div class="content">
              <pre class="code" id="dcnm-advanced"></pre>
              <div class="copyRow"><button class="btn" data-copy="dcnm-advanced">Copy</button></div>
            </div>
          </section>
        </div>
      </div>
    </section>

    <!-- ===================== PAGE: LOCAL-IN ===================== -->
    <section id="page-localin" class="page">
      <div class="card">
        <h2>Local-In Policy Golden Config</h2>
        <div class="content">
          <div class="field">
            <label for="localInterface">Select Interface</label>
            <select id="localInterface">
              <option value="wan1">wan1</option>
              <option value="port1">port1</option>
              <option value="custom">custom…</option>
            </select>
          </div>
          <div class="field" id="customIntfRow" style="display:none;">
            <label for="localCustomIntf">Custom interface</label>
            <input id="localCustomIntf" placeholder="e.g. port2 or wan2" />
          </div>
          <div class="row">
            <button class="btn primary" id="generateLocal">Generate Config</button>
            <button class="btn" id="copyLocal">Copy Output</button>
          </div>
          <div class="field" style="margin-top:12px;">
            <label>Output</label>
            <pre class="code" id="localOutput"></pre>
          </div>
        </div>
      </div>
    </section>

    <!-- ===================== PAGE: VDC BUILD ===================== -->
    <section id="page-future" class="page">
      <div class="card">
        <h2>Page 4: VDC Build Helper</h2>
        <div class="content">
          <p class="muted">
            This page helps you build out VDC and vSphere objects using the values from your Home page inputs.
          </p>

          <div class="card" style="margin-bottom:12px;">
            <h2>Quick Links</h2>
            <div class="content">
              <div class="kv">
                <div class="k">vSphere:</div>
                <div class="v"><a id="vdc-vsphere-link" href="#" target="_blank">—</a></div>
                <div class="k">VDC:</div>
                <div class="v"><a id="vdc-vdc-link" href="#" target="_blank">—</a></div>
              </div>
            </div>
          </div>

          <section class="card" style="margin-top:8px;">
            <h2>Build Steps</h2>
            <div class="content">
              <pre class="code" id="vdc-steps"></pre>
              <div class="copyRow"><button class="btn" data-copy="vdc-steps">Copy Steps</button></div>
            </div>
          </section>
        </div>
      </div>
    </section>
  </div>

  <div id="debugBanner"></div>

  <!-- ===================== SCRIPT ===================== -->
  <script>
    'use strict';

    // ---- Lightweight selectors with logging ----
    function q(sel) {
      const n = document.querySelector(sel);
      if (!n) console.warn('Missing node:', sel);
      return n;
    }
    function qq(sel) {
      return Array.prototype.slice.call(document.querySelectorAll(sel));
    }

    // ---- Debug banner helpers ----
    function showOK(msg) {
      const b = q('#debugBanner');
      if (!b) return;
      b.className = '';
      b.classList.add('ok');
      b.textContent = msg || 'JS OK';
    }
    function showErr(msg) {
      const b = q('#debugBanner');
      if (!b) return;
      b.className = '';
      b.classList.add('err');
      b.textContent = msg;
    }

    // ---- Global error trap ----
    window.addEventListener('error', e => {
      showErr('Error: ' + (e && e.message ? e.message : 'unknown'));
    });
    window.addEventListener('unhandledrejection', e => {
      showErr('Promise: ' + (e && e.reason ? e.reason : 'unknown'));
    });

    // ---- IP helpers ----
    function ipToInt(ip) {
      const p = ip.split('.').map(Number);
      if (p.length !== 4 || p.some(n => !Number.isInteger(n) || n < 0 || n > 255)) {
        throw new Error('Bad IP');
      }
      return (((p[0] * 256 + p[1]) * 256 + p[2]) * 256 + p[3]) >>> 0;
    }
    function intToIp(x) {
      x = x >>> 0;
      return [(x >>> 24) & 255, (x >>> 16) & 255, (x >>> 8) & 255, x & 255].join('.');
    }
    function prefixToMask(prefix) {
      prefix = Number(prefix);
      if (!(prefix >= 0 && prefix <= 32)) throw new Error('Bad prefix');
      const mask = prefix === 0 ? 0 : (0xFFFFFFFF << (32 - prefix)) >>> 0;
      return { int: mask >>> 0, dotted: intToIp(mask >>> 0) };
    }
    function parseCIDR(cidr) {
      const parts = (cidr || '').trim().split('/');
      if (parts.length !== 2) throw new Error('CIDR must be like 203.0.113.0/29');
      const ipStr = parts[0];
      const pfxStr = parts[1];
      const prefix = Number(pfxStr);
      if (!Number.isInteger(prefix) || prefix < 0 || prefix > 32) throw new Error('Bad prefix');
      const ipInt = ipToInt(ipStr);
      const block = 2 ** (32 - prefix);
      const network = Math.floor(ipInt / block) * block >>> 0;
      const broadcast = (network + block - 1) >>> 0;
      let first, last;
      if (prefix === 32) {
        first = network; last = network;
      } else if (prefix === 31) {
        first = network; last = broadcast;
      } else {
        first = (network + 1) >>> 0;
        last = (broadcast - 1) >>> 0;
      }
      return { prefix, ipInt, ipStr, network, broadcast, first, last, mask: prefixToMask(prefix) };
    }

    // ---- DC mapping for BGP SVC leaves ----
    function dcSecondOctet(dc) {
      switch ((dc || '').toUpperCase()) {
        case 'IAD': return 101;
        case 'ORD': return 105;
        case 'LAX': return 107;
        default:    return 100;
      }
    }

    // ---- vSphere/VDC URLs ----
    function vsphereUrl(dc) {
      switch ((dc || '').toUpperCase()) {
        case 'LAX':
          return 'https://lax01m01vi01vc.rapidscale.local/websso/SAML2/SSO/vsphere.local?SAMLRequest=zVRbb9MwFH7nV0R%2BT5wb2mI1ncrKRKWNlaUgxAtyndPWUmIHHyfp%2Fj1O2kI1wegjD1Ek55zP3%2BWcTG72deV1YFBqlZMoCIkHSuhSqm1OPq%2Fu%2FGtyM30zQV5XDZu1dqee4EcLaL0ZIhjr2m61wrYGU4DppICFKmGfEwc0d2VScTtC76xtkFFa8X0Y1WHUSfeIwPBGlih4BUGl3Yv2sEbUtJg93Me0KB5ph80OzPEz8e60ETASycmGVwjEW8xz8r1MSrHhcZLwSKTlVZmmWbi%2BzrJSZNcbkTk6C1xyRNnB70bE1vFFy5XNSRzGb%2F0o8uN0FYcsuWJJFoRZ9I14S6OtFrp6J9XBmNYopjlKZIrXgMwKNhBmcRCy9aEI2YfVaukvH4vVCNDJEsxHV52Tf1jA0jQh3pdTJvGQiUtJIRtTeP325kiVTI%2BZjRrN5QD8FCuZXhpZK%2BkAfIquBstLbvmEnjM48IkbNniwmC91JcWzN6sq3d8a4Nb5Yk0LY8A1t6%2BTHE5k6W%2FGUtYMVqEFZYlXLAf8Ty2v5EaCuXzu%2FiLi3Pr4Uu%2FpUSxzq1HKwUw8h7k4gJcoR5DOtRyEOV1d3XO3HULXFMUOao6UW2v8EZjGYRTTMKXv986eYZ7wJGiP8hdG3%2FdBnwTabF1DGNGvD%2FfFiOXLcTmEi8XVM%2FvcuJiG69kTKOj5uoKVO%2FuD4P%2BI6hwq2J5TpS%2FDmZ5G9fwHN%2F0J&RelayState=87c20fa2-fbc5-4b60-add7-038d1dc3bca6&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=S7SgFwY%2FpAPqMtmw0V93LGzykCBqcmHqjkD8fGASU56oxUhXSsNPlRpa87hZeze58bVht19lR0I8xT1m6CZWx3Kpn5GOASaOgMv9NvCoImg1eaDts5T1CbcZ8ohaj6SafFw363Mc9jFlQF1CUeCUQRK6dX0ydWCmwSUUgYHFiNrSS5YvrGdC%2FwCJYjVJZ1w6TN6XMv6P6ZaYTkl6GraN4cxfPsE9TBjG75XuRMg9kyIKa81yDQP8JHVyhFxaHhGtXwUzDozyNKscGyo3YJtan3U3Q7Dh4tKbYEZttHPTyPlltdl1HSDorPgYybYUETU5HwcjIlMMElHyQrw0qEwzGFM2rx1ZW8sv%2FqC6D4ynsvYJnjE6fGn%2FtTV1cIQTg13rszXswA%2FoE7wvarcthhzqsUFABDvIuL5aVUwb1PJpIFTHGDBibIpwdwGO88WZTy8w7ViZgkSNRrNQocd9eake0CD6Gv5yljimC344VwHD8UgfNyCccP7iCJtsBhl2WZVB&isDiscovery=true&appUrl=https%3A%2F%2Flax01m01vi01vc.rapidscale.local%2Fui%2Flogin';
        case 'IAD':
          return 'https://iad01iavc01.rapidscale.local/websso/SAML2/SSO/vsphere.local?SAMLRequest=zVTfb5swEH7fX4H8DgZCmtQKqbJm1SK1KyvZNO1lcuBILIHNfAbS%2F36GJFtUbVEexwuSufvu%2B3FmdrevSqcFjULJmASeTxyQmcqF3Mbky%2FrBnZK7%2BbsZ8qqs2aIxO%2FkCPxtA4ywQQRvbdq8kNhXoFHQrMljJHPYxsUBLWyYkNwP0zpgaGaWC534geJv5gad5LXLMeAleqeyLdrBBVDRdPD2GNE2faYv1DvTxM3EelM5gYBGTgpcIxFktY%2FJjHN1uNsWGh7eTIpgE9smjSVTwEYxvikk0smWYcETRwp9GxMaSRcOliUnoh2M3CNwwWoc%2BG01ZNPZu%2FOl34iRaGZWp8r2QB1caLZniKJBJXgEyk7GeMAs9n20ORcg%2BrteJmzyn6wGgFTnoT7Y6Jpf0s6in%2BvWURtinYfORyAb%2FL4%2BujzzJ%2FJjWIFBfD8BPgZL5VWE1gvaop9AqMDznhs%2Fo%2BfgDmbBmvfrVMlGlyF6dRVmq7l4DN9YRoxYoq24ucywPxG5WwylrO59QgPSECdNevzPDS9FIUBfuW7%2FUHBuenit6%2FSolNnrkIveRjyHudr6tyhHkNa2HFRZUW3VcXspMlVRzHZQcaTcGO0OwDT0g5D6Ef2wt970m4QnQXsUvzG6rvO6kaf01jb4Af329JgOWK4Y7kRmM7H1zLzWNqN%2BPHsBCR3flLC2Z38R%2FB9RXUIJ23Oq9G0489Oenv%2FU5r8A&RelayState=f11cc8cf-0081-4641-a646-af42db1aa17f&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=ctNlfEtfHRAXj1%2FMgDjv8kWoxfbX8%2B6AOBz0nGY5hpuWEGehWHMi5%2F83YGCcHsxzxINqj7zE9mB%2BrwCX3xA4SbCJvEKVFd6J2156jjn5zLdftYUWxMqZOZBSjZuYNw5noqs1IvmFedV2hlGNjrPMYxun4sNicI4VUXNPJ0pglJvKVQaiHbmbPkcDT45F2OcXy%2BJ7NSrTBBWNxvIVSOxLQE6H41tECLTTZOtVdo9Urpnuloy6SyUM4VbeVSo%2B0ZZYq%2B75WOgZaSPlELE337aBVZ5r9siTg7N5%2FhtPFsmGkh6D%2BXvb3%2FWUl1zM4rhhJAWSEjxVEza5su2jdXGUzViG5g%3D%3D';
        case 'DAL':
          return 'https://dal01iavc01.rapidscale.local/websso/SAML2/SSO/vsphere.local?SAMLRequest=zVTfb5swEH7fX4H8DgaXpI1VUmXNqkVq16xk07SXyYFLY8nYzGcg%2Fe9nSLJF1VblcU9I5u6774fP1ze7SgUtWJRGZySJYhKALkwp9XNGvqzuwityM313jaJSNZ81bquf4GcD6IIZIljn226NxqYCm4NtZQELXcIuIx5o7sukFm6A3jpXI6e0FCpOpGiLOImsqGWJhVAQKeM%2FtIM1oqH57OGe0Tx%2FpC3WW7CH3yS4M7aAgUVGNkIhkGAxz8gPNi5HIzEeTUabdHw5uZqsYZxcihTWG2CXqeeywKVAlC38aURsPFl0QruMsJiNwiQJWbpiMb%2BYcDaO2NXoOwmW1jhTGPVe6r0rjdXcCJTItagAuSt4T5izKObrfRHyj6vVMlw%2B5qsBoJUl2E%2B%2BOiNv6edpekGCr8c0WJ%2BGz0cjH%2Fx%2Fe3R94Emmh7QGgfZ8AHEMlEzPCquRtEc9hlaBE6Vw4pqejt%2BTYTXv1S%2FmS6Nk8RLMlDLdrQXhvCPONjBEWwn3NsP%2BRJbhZijlde8TOtCOBPmyx%2F%2FcCCU3EuyZ1%2B0fCk5NZ%2Be6Tg9KuV%2BHUvY24inM2da%2FRjmAtL5lr8qLaqtO%2BKUoTEWx2EIlkArnbDgAUxYnjMYp%2FbDz3vQ3CY%2BCdih%2FY3RdF3UXkbHPviFO6LeH%2B3zACuWwE4XPxNdz91L7jPrx%2FAk0dGKtYOXP%2FiL4P6I6BwXPp1Tp63Cmx3t6%2BqhNfwE%3D&RelayState=a396558e-d80a-497b-90c9-3fb5bbfb2b84&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=ioKA%2F2EcweHiidsbRK%2Fle%2B3Ec7r4a0OVj5GWTNGI08ky2tAtbaLFuRwAoEhRO3SPNbZtbVKbw%2B0mcQ7we01keKC2GRhHZmEFFynCgAdI5Lsl8uszSIxLrmVQ7ZPBeHhX7t2FSp6vczJzM1lhdFagYe4JFTMR08Henw4B2RkF4v%2FLgsXsKQVxe6l3oR8k0J6ZNok60CbvKGEBS%2Fd0A%2FZQWTExv1WVZM41rUzcEF9F51OMGQy81%2FRZIZOLCWvXy3WZTQOaKK9ByhDfWPgQnHwNSHjmEIAi0dztJMA8BXVJJ1diRqf9S%2FoAVJyH3FVqOuZq6b4aPMcyx3WJCMeFwA%2BymA%3D%3D';
        case 'ORD':
          return 'https://ord01iavc01.rapidscale.local/websso/SAML2/SSO/iana.rs.local?SAMLRequest=zVTfb5swEH7fX4H8DjaEtMEKqbJm1Sq1a1ayadrL5MAltQQ28xlI%2F%2FsZkmxRtUV53BOSufvu%2B3H29GZXlV4LBqVWKQkDRjxQuS6k2qbky%2BrOn5Cb2bspiqqs%2BbyxL%2BoZfjaA1psjgrGu7VYrbCowGZhW5nCvCtilxAEtXJlUwg7QL9bWyCnVpmChFG3OwsCIWhaYixKCUrsP7WCNqGk2f3yIaJY9USmUCAzufxPvTpscBhYp2YgSgXj3i5T8YMDG8TW7CpN4MoIENkkiJiyabNYwHiXXG1eGS4EoW%2FjTiNg4smiFsimJWDT2w9CP4lXE%2BCjh4yS4iiffibc02upcl%2B%2Bl2rvSGMW1QIlciQqQ25z3hHkUML7eFyH%2FuFot%2FeVTthoAWlmA%2BeSqU3JOP4%2FjEfG%2BHtOI%2BjRcPgr54P%2F50fWBJ5kd0hoEmssBxDFQMrsorEbSHvUYWgVWFMKKKT0dvycT1bxXf79Y6lLmr968LHV3a0BY54g1DQzRVsKeZ9ifyMLfDKW87n1CC8oSL1v2%2BJ8bUcqNBHPhuv1Dwanp0aWu04NS7q5DIXsb8RTmYuvfohxAWteyV%2BVEtVUnDAS5rijmL1AJpMJa4w%2FANGJhRFlMP%2BycN%2F0m4VHQDuVvjK7rgm4UaLN1DSyk3x4fsgHLl8OdyF0mrp7b19pl1I%2Fnz6CgE%2BsSVu7sL4L%2FI6oLKGF7SpW%2BDWd23NPTR232Cw%3D%3D&RelayState=b5bb93f8-76e7-40bd-9ac4-4c92ba0cafd4&SigAlg=http%3A%2F%2Fwww.w3.org%2F2001%2F04%2Fxmldsig-more%23rsa-sha256&Signature=Wzs4IXFbqynoNZIEHZZmE0fWC3ugFoZrG%2BlNNik5XVzPDqHXlc%2F6ujpFD318MEN4v%2FxrFbpZ9n3spSI9AZ9O8E8eN5AyKMRGkXlSuEpY3cCl2lPCgHGNRoBGB0gxMd%2BmT4sBuz8UCd3H3fFH4gGenY%2F%2FMI36hr19ezmbpfeVyLUpHCfDxOau8eH1h1LO%2FrEa%2BrLzW8URQ%2FkfXsUOM3GK17qiCENL1X6M7Eg1sHDRY6LdDjK1ewWK3DmavXKGdlV02GZ8mjafAoob3m7Ch3zdm6IqGjB1rpb6Ih6tGfs6VfxMsSDQOmVmxNXeK66BAyjqXRCJnCwFBNZA8GWSMCbIJQ%3D%3D';
        default:
          return '';
      }
    }

    function vdcUrl(dc) {
      switch ((dc || '').toUpperCase()) {
        case 'LAX': return 'https://lax01vcd.rsportal.net/login/?service=provider&redirectTo=%2Fprovider%2F';
        case 'IAD': return 'https://iad01vcd.rsportal.net/login/?service=provider&redirectTo=%2Fprovider%2F';
        case 'DAL': return 'https://dal01vcd.rsportal.net/login/?service=provider&redirectTo=%2Fprovider%2Fcloud%2Forganizations';
        case 'ORD': return 'https://ord01vcd.rsportal.net/login/?service=provider&redirectTo=%2Fprovider%2Fcloud%2Forganizations';
        default:    return '';
      }
    }

    // ---- BGP leaves builder ----
    function buildBGPLeaves(vlan, dc) {
      if (!vlan) return '';
      const vlanStr = String(vlan).trim();
      const tag = vlanStr.length === 3 ? ('40' + vlanStr) : ('4' + vlanStr);
      const second = dcSecondOctet(dc);
      const leaves = [6, 7, 8, 9];
      return leaves
        .map(o => 'Vlan ' + vlanStr + '\n     rd 10.' + second + '.220.' + o + ':' + tag +
                   '\n     route-target both ' + tag + ':' + tag +
                   '\n     redistribute learned')
        .join('\n\n');
    }

    // ---- Tabs ----
    function activateTab(id) {
      ['all', 'wanvlan', 'vcgvlan', 'route', 'bgp'].forEach(t => {
        const tab = document.querySelector('.tab[data-tab="' + t + '"]');
        if (tab) tab.classList.toggle('active', t === id);
        const sec = document.getElementById('sec-' + t);
        if (sec) sec.style.display = (t === id ? 'block' : 'none');
      });
    }

    // ---- Router (top nav) ----
    function setActiveNav() {
      const hash = location.hash || '#home';
      qq('#topnav a[data-route]').forEach(a => {
        a.classList.toggle('active', a.getAttribute('href') === hash);
      });
    }
    function showPageFromHash() {
      const id = (location.hash || '#home').slice(1);
      qq('.page').forEach(p => p.classList.remove('active'));
      const page = document.getElementById('page-' + id);
      if (page) page.classList.add('active');
      setActiveNav();
    }

    // ---- Local-In builder ----
    function buildLocalInConfig(intf) {
      return (
        'config firewall address\n' +
        'edit "RS-MGMT-Block"\n' +
        'set subnet 184.189.47.0/27\n' +
        'next\n' +
        'edit "Ansible1"\n' +
        'set subnet 185.159.5.146 255.255.255.255\n' +
        'next\n' +
        'edit "Ansible2"\n' +
        'set subnet 185.159.5.148 255.255.255.255\n' +
        'next\n' +
        'edit "RS-SNMP"\n' +
        'set subnet 185.159.5.148 255.255.255.255\n' +
        'next\n' +
        'edit "RS_PRTG_SNMP1"\n' +
        'set subnet 103.219.222.45 255.255.255.255\n' +
        'next\n' +
        'edit "RS_PRTG_SNMP2"\n' +
        'set subnet 98.186.17.128 255.255.255.128\n' +
        'next\n' +
        'end\n\n' +
        'config firewall addrgrp\n' +
        'edit "FirewallAccess_WAN"\n' +
        'set member "RS-MGMT-Block" "Ansible1" "Ansible2"\n' +
        'next\n' +
        'edit "RS_PRTG_MON"\n' +
        'set member "RS_PRTG_SNMP1" "RS_PRTG_SNMP2"\n' +
        'next\n' +
        'end\n\n' +
        'config firewall service custom\n' +
        'edit "9443"\n' +
        'set category "Remote Access"\n' +
        'set tcp-portrange 9443\n' +
        'next\n' +
        'edit "922"\n' +
        'set category "Remote Access"\n' +
        'set tcp-portrange 922\n' +
        'next\n' +
        'end \n\n' +
        'config firewall local-in-policy\n' +
        'edit 1\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "FirewallAccess_WAN"\n' +
        'set dstaddr "all"\n' +
        'set action accept\n' +
        'set service "9443"\n' +
        'set schedule "always"\n' +
        'next\n' +
        'edit 2\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "FirewallAccess_WAN"\n' +
        'set dstaddr "all"\n' +
        'set action accept\n' +
        'set service "922"\n' +
        'set schedule "always"\n' +
        'next\n' +
        'edit 3\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "RS_PRTG_MON"\n' +
        'set dstaddr "all"\n' +
        'set action accept\n' +
        'set service "SNMP"\n' +
        'set schedule "always"\n' +
        'next\n' +
        'edit 4\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "RS_PRTG_MON"\n' +
        'set dstaddr "all"\n' +
        'set action accept\n' +
        'set service "ALL_ICMP"\n' +
        'set schedule "always"\n' +
        'next \n' +
        'edit 50\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "all"\n' +
        'set dstaddr "all"\n' +
        'set service "9443"\n' +
        'set schedule "always"\n' +
        'next\n' +
        'edit 51\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "all"\n' +
        'set dstaddr "all"\n' +
        'set service "SNMP"\n' +
        'set schedule "always"\n' +
        'next\n' +
        'edit 52\n' +
        'set intf "' + intf + '"\n' +
        'set srcaddr "all"\n' +
        'set dstaddr "all"\n' +
        'set service "922"\n' +
        'set schedule "always"\n' +
        'next\n' +
        'end'
      );
    }

    // ---- Export / Import helpers ----
    function collectState() {
      return {
        version: 3,
        savedAt: new Date().toISOString(),
        fields: {
          custName: (q('#custName') && q('#custName').value) || '',
          sfid:     (q('#sfid') && q('#sfid').value) || '',
          dc:       (q('#dc') && q('#dc').value) || '',
          wanVlan:  (q('#wanVlan') && q('#wanVlan').value) || '',
          vcgVlan:  (q('#vcgVlan') && q('#vcgVlan').value) || '',
          cidr:     (q('#cidr') && q('#cidr').value) || ''
        }
      };
    }
    function applyState(obj) {
      if (!obj || !obj.fields) return;
      const f = obj.fields;
      if (q('#custName')) q('#custName').value = f.custName || '';
      if (q('#sfid'))     q('#sfid').value     = f.sfid || '';
      if (q('#dc'))       q('#dc').value       = f.dc || '';
      if (q('#wanVlan'))  q('#wanVlan').value  = f.wanVlan || '';
      if (q('#vcgVlan'))  q('#vcgVlan').value  = f.vcgVlan || '';
      if (q('#cidr'))     q('#cidr').value     = f.cidr || '';
      compute();
    }
    function doExport() {
      const state = collectState();
      const name = (state.fields.custName || 'Customer').replace(/[^A-Za-z0-9_-]+/g, '_');
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'CustomerBuildSheet_' + name + '_' + Date.now() + '.json';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(a.href);
        a.remove();
      }, 0);
    }
    function doImport(file) {
      const r = new FileReader();
      r.onload = () => {
        try {
          const obj = JSON.parse(r.result);
          applyState(obj);
          alert('Import successful');
        } catch (e) {
          alert('Invalid JSON file.');
        }
      };
      r.readAsText(file);
    }

    // ---- Core compute & render ----
    function compute() {
      const cust = (q('#custName') && q('#custName').value.trim()) || '';
      const sfid = (q('#sfid') && q('#sfid').value.trim()) || '';
      const dc   = (q('#dc') && q('#dc').value.trim()) || '';
      const wan  = (q('#wanVlan') && q('#wanVlan').value.trim()) || '';
      const vcg  = (q('#vcgVlan') && q('#vcgVlan').value.trim()) || '';
      const cidr = (q('#cidr') && q('#cidr').value.trim()) || '';

      // Preview names
      const wn = q('#wanNamePreview');
      const vn = q('#vcgNamePreview');
      if (wn) wn.textContent = cust ? (cust + ' - WAN') : '(auto)';
      if (vn) vn.textContent = cust ? (cust + ' - VCG') : '(auto)';

      // IPAM logic
      let gw = '—', fw = '—', mask = '—', prefix = '—';
      try {
        if (cidr) {
          const parsed = parseCIDR(cidr);
          prefix = parsed.prefix;
          mask = parsed.mask.dotted;
          if (parsed.prefix === 32) {
            gw = fw = '—';
          } else if (parsed.prefix === 31) {
            gw = intToIp(parsed.network);
            fw = intToIp((parsed.network + 1) >>> 0);
          } else {
            gw = intToIp(parsed.first);
            const secondIp = Math.min(parsed.last, (parsed.first + 1) >>> 0);
            fw = intToIp(secondIp);
          }
        }
      } catch (e) {
        // invalid CIDR -> keep placeholders
      }

      if (q('#gw')) q('#gw').textContent = gw;
      if (q('#fw')) q('#fw').textContent = fw;
      if (q('#mask')) q('#mask').textContent = mask;
      const desc = (dc && cust && sfid) ? '(' + dc + ') - ' + cust + ' - ' + sfid : '—';
      if (q('#desc')) q('#desc').textContent = desc;
      if (q('#kvWanVlan')) q('#kvWanVlan').textContent = wan || '—';
      if (q('#kvDc')) q('#kvDc').textContent = dc || '—';

      // Arista sections
      const secWAN = 'vlan ' + wan + '\n      name ' + cust + '-' + sfid + '-WAN';
      const secVCG = 'vlan ' + vcg + '\n    name ' + cust + '-' + sfid + '-VCG';
      const secRoute =
        'interface Vlan' + wan + '\n' +
        '  description ' + cust + '-' + sfid + '-WAN\n' +
        '  vrf RS-INET\n' +
        '  ip address ' + gw + ' ' + mask;
      const secBGP = buildBGPLeaves(wan, dc);
      const secBGPVCG = (dc === 'IAD' ? buildBGPLeaves(vcg, dc) : '');

      if (q('#code-wanvlan')) q('#code-wanvlan').textContent = secWAN;
      if (q('#code-vcgvlan')) q('#code-vcgvlan').textContent = secVCG;
      if (q('#code-route')) q('#code-route').textContent = secRoute;
      if (q('#code-bgp')) q('#code-bgp').textContent = secBGP;

      const dontEl = q('#dontforget');
      const codeBgpVcg = q('#code-bgp-vcg');
      if (dontEl) dontEl.style.display = (dc === 'IAD' ? 'block' : 'none');
      if (codeBgpVcg) codeBgpVcg.textContent = secBGPVCG;

      const parts = [secWAN, '', secVCG, '', secRoute, '', secBGP];
      if (dc === 'IAD') parts.push('', secBGPVCG);
      if (q('#code-all')) q('#code-all').textContent = parts.join('\n');

      const dalBanner = q('#dalBanner');
      if (dalBanner) dalBanner.style.display = (dc === 'DAL' ? 'block' : 'none');

      // Static route helper
      const routes = qq('.static-route').map(i => i.value.trim()).filter(Boolean);
      if (routes.length && fw !== '—') {
        const cmds = routes
          .map(r => 'ip route vrf RS-INET ' + r + ' ' + fw + ' tag 10 name ' + cust + '-addtl')
          .join('\n');
        if (q('#staticOut')) q('#staticOut').textContent = cmds;
      } else if (q('#staticOut')) {
        q('#staticOut').textContent = '';
      }

      // DCNM
      const netId = (wan && String(wan).length === 3) ? ('40' + wan) : (wan ? ('4' + wan) : '');
      const vlanNameRaw = cust + '-WAN';
      const vlanName = vlanNameRaw.length > 30 ? vlanNameRaw.slice(0, 30) : vlanNameRaw;
      const showWarn = vlanNameRaw.length > 30;

      const netInfo = [
        'Network ID - ' + netId,
        'Network Name - ' + cust + '-WAN',
        'VRF Name - Leave as default',
        'Layer 2 Only - Leave as default',
        'Network Template - Leave as default',
        'Network Extension Template - Leave as default',
        'VLAN ID - ' + wan
      ].join('\n');

      const netProfile = [
        'IPv4 Gateway/NetMask - ' + gw + '/' + prefix,
        'IPv6 Gateway/Prefix - Leave as default',
        'VLAN Name - ' + vlanName,
        'Interface Description - ' + cust + '-' + sfid + '-WAN',
        'MTU for L3 interface - Leave as default',
        'IPv4 Secondary GW1 - Leave as default',
        'IPv4 Secondary GW2 - Leave as default',
        'IPv4 Secondary GW3 - Leave as default',
        'IPv4 Secondary GW4 - Leave as default'
      ].join('\n');

      const adv = [
        'ARP Suppression - Tick the box',
        'Ingress Replication - Leave as default',
        'Multicast Group Address - Leave as default',
        'DHCPv4 Server 1 - Leave as default',
        'DHCPv4 Server VRF - Leave as default',
        'DHCPv4 Server 2 - Leave as default',
        'DHCPv4 Server2 VRF - Leave as default',
        'Loopback ID for DHCP Relay interface - Leave as default',
        'Routing Tag - 1000',
        'TRM Enable - Leave as default',
        'L2 VNI Route-Target Both Enable - Leave as default',
        'Enable L3 Gateway on Border - Leave as default'
      ].join('\n');

      if (q('#dcnm-netinfo')) q('#dcnm-netinfo').textContent = netInfo;
      if (q('#dcnm-netprofile')) q('#dcnm-netprofile').textContent = netProfile;
      if (q('#dcnm-advanced')) q('#dcnm-advanced').textContent = adv;

      const warnEl = q('#vlanNameWarning');
      if (warnEl) warnEl.style.display = showWarn ? 'block' : 'none';

      // ---- VDC build helper text ----
      const vsUrl = vsphereUrl(dc);
      const vdcUrlStr = vdcUrl(dc);

      const vSphereLink = q('#vdc-vsphere-link');
      if (vSphereLink) {
        vSphereLink.textContent = vsUrl || ('No vSphere URL defined for ' + (dc || '?'));
        vSphereLink.href = vsUrl || '#';
        vSphereLink.target = vsUrl ? '_blank' : '_self';
      }

      const vdcLink = q('#vdc-vdc-link');
      if (vdcLink) {
        vdcLink.textContent = vdcUrlStr || ('No VDC URL defined for ' + (dc || '?'));
        vdcLink.href = vdcUrlStr || '#';
        vdcLink.target = vdcUrlStr ? '_blank' : '_self';
      }

      const vdcLines = [];
      vdcLines.push('Building FortiGate Manually');
      vdcLines.push('Pre-requisites');
      vdcLines.push('1. Need to have the VLANs pulled.');
      vdcLines.push('2. Need to have WAN IP pulled.');
      vdcLines.push('3. VLANs and WAN IP need to be configured into Arista or DCNM.');
      vdcLines.push('');
      vdcLines.push('Step 1: vSphere Distributed Port Groups');
      vdcLines.push('- Go to vSphere for that datacenter.');
      vdcLines.push('');
      vdcLines.push('Your Datacenter vSphere: ' + (dc || '<Datacenter>'));
      vdcLines.push('URL: ' + (vsUrl || '<No vSphere URL defined for this DC>'));
      vdcLines.push('');
      vdcLines.push('- Click on the Globe icon, then expand <datacenter>01iavc01.rapidscale.local');
      vdcLines.push('- Click on <datacenter>01ia then <datacenter>iadvs03-Guest');
      vdcLines.push('- Right Click on root guest and click Distributed Port Group > New Distributed Port');
      vdcLines.push('  WAN Port Group:');
      vdcLines.push('    Name: "ext' + (wan || '<WAN_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-WAN"');
      vdcLines.push('    VLAN type: VLAN');
      vdcLines.push('    VLAN ID: ' + (wan || '<WAN_VLAN>'));
      vdcLines.push('    Click Next and Finish');
      vdcLines.push('');
      vdcLines.push('  VCG Port Group (repeat with VCG VLAN):');
      vdcLines.push('    Name: "ext' + (vcg || '<VCG_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-VCG"');
      vdcLines.push('    VLAN type: VLAN');
      vdcLines.push('    VLAN ID: ' + (vcg || '<VCG_VLAN>'));
      vdcLines.push('    Click Next and Finish');
      vdcLines.push('');
      vdcLines.push('Now go to VDC');
      vdcLines.push('Your VDC: ' + (dc || '<Datacenter>'));
      vdcLines.push('URL: ' + (vdcUrlStr || '<No VDC URL defined for this DC>'));
      vdcLines.push('- Log in via SAML');
      vdcLines.push('');
      vdcLines.push('Step 2: External Network for WAN');
      vdcLines.push('- Click External Networks');
      vdcLines.push('- Click New');
      vdcLines.push('- vSphere Resources (Distributed Port Groups) > Next');
      vdcLines.push('  Name: "ext' + (wan || '<WAN_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-WAN"');
      vdcLines.push('  Description: "' + (gw !== '—' ? gw : '<Gateway>') + ' - ' + (cust || '<Customer>') + ' - ' + (sfid || '<SFID>') + '"');
      vdcLines.push('  Gateway CIDR: "' + ((gw !== '—' && prefix !== '—') ? (gw + '/' + prefix) : '<Gateway/CIDR>') + '"');
      vdcLines.push('  Static IP Pools: "' + (fw !== '—' ? fw : '<Firewall IP>') + '"');
      vdcLines.push('- Click Next');
      vdcLines.push('  Filter for: ext' + (wan || '<WAN_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-WAN');
      vdcLines.push('- Configuration: Click New');
      vdcLines.push('  Gateway with CIDR: ' + ((gw !== '—' && prefix !== '—') ? (gw + '/' + prefix) : '<Gateway/CIDR>'));
      vdcLines.push('  Static Pool: ' + (fw !== '—' ? fw : '<Firewall IP>'));
      vdcLines.push('- Click Next, then Finish');
      vdcLines.push('');
      vdcLines.push('Step 3: External Network for VCG');
      vdcLines.push('- Repeat External Network creation but use the VCG VLAN:');
      vdcLines.push('  Name: "ext' + (vcg || '<VCG_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-VCG"');
      vdcLines.push('  Description: "<VCG Gateway/CIDR> - ' + (cust || '<Customer>') + ' - ' + (sfid || '<SFID>') + '" (adjust as needed)');
      vdcLines.push('- Finish the wizard');
      vdcLines.push('');
      vdcLines.push('Step 4: Create Organization');
      vdcLines.push('- Click Organizations');
      vdcLines.push('- Click New');
      vdcLines.push('  Organization Name: ' + (cust || '<Customer>'));
      vdcLines.push('  Organization Full Name: ' + (cust || '<Customer>'));
      vdcLines.push('  Description: ' + (cust || '<Customer>') + ' - ' + (sfid || '<SFID>'));
      vdcLines.push('  Enable Sub-Provider: leave UNCHECKED');
      vdcLines.push('- Click Create');
      vdcLines.push('');
      vdcLines.push('Step 5: Organization Policies & Metadata');
      vdcLines.push('- Click into your new Organization');
      vdcLines.push('- Click Policies');
      vdcLines.push('  vApp Leases: Never Expires');
      vdcLines.push('  Runtime Expiry Action: Never Expires');
      vdcLines.push('  vApp Template Lease: Never Expires');
      vdcLines.push('- Click Metadata');
      vdcLines.push('  CRMUID: ' + (sfid || '<SFID>'));
      vdcLines.push('- Save');
      vdcLines.push('');
      vdcLines.push('Step 6: Create Organization VDC');
      vdcLines.push('- Click Organization VDCs');
      vdcLines.push('- Click New');
      vdcLines.push('  Name: ' + (cust || '<Customer>') + (dc || '<DC>'));
      vdcLines.push('  Description: ' + (cust || '<Customer>') + ' - ' + (sfid || '<SFID>') + ' - ' + (gw !== '—' ? gw : '<Gateway>'));
      vdcLines.push('  Enable the Organization VDC: leave checked');
      vdcLines.push('  Organization: select the org you just created');
      vdcLines.push('- Click Next');
      vdcLines.push('  Provider VDC: select the only option');
      vdcLines.push('- Click Next');
      vdcLines.push('  Allocation Model: Pay-As-You-Go');
      vdcLines.push('  CPU resources guaranteed: 0');
      vdcLines.push('  vCPU speed: 8GHz');
      vdcLines.push('  Memory resources guaranteed: 0');
      vdcLines.push('- Click Next');
      vdcLines.push('  Storage Policies: select SSD, enable Thin Provisioning');
      vdcLines.push('- Click Next');
      vdcLines.push('  Network Pool: VXLAN');
      vdcLines.push('- Click Next, then Finish');
      vdcLines.push('');
      vdcLines.push('Step 7: Tenant Networks (WAN & VCG)');
      vdcLines.push('- Click into your Organization');
      vdcLines.push('- Click Open Tenant Portal');
      vdcLines.push('- On the left, click Networking');
      vdcLines.push('');
      vdcLines.push('WAN Network:');
      vdcLines.push('- Click New');
      vdcLines.push('  Scope: Organization Virtual Data Center');
      vdcLines.push('  Select the Org VDC you created');
      vdcLines.push('- Click Next');
      vdcLines.push('  Network Type: Direct');
      vdcLines.push('- Click Next');
      vdcLines.push('  Name: ' + (cust || '<Customer>') + 'WAN');
      vdcLines.push('  Description: ' + ((gw !== '—') ? gw : '<Gateway>') + ' - ' + (cust || '<Customer>') + ' - ' + (sfid || '<SFID>'));
      vdcLines.push('  Shared: leave disabled');
      vdcLines.push('- Click Next');
      vdcLines.push('  External Network Connection: filter for "ext' + (wan || '<WAN_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-WAN" and select it');
      vdcLines.push('- Click Next, then Finish');
      vdcLines.push('');
      vdcLines.push('VCG Network:');
      vdcLines.push('- Click New');
      vdcLines.push('  Scope: Organization Virtual Data Center (same Org VDC)');
      vdcLines.push('- Click Next');
      vdcLines.push('  Network Type: Direct');
      vdcLines.push('- Click Next');
      vdcLines.push('  Name: ' + (cust || '<Customer>') + 'VCG');
      vdcLines.push('  Description: 172.26.0.14 - ' + (cust || '<Customer>') + ' - ' + (sfid || '<SFID>') + ' (adjust if needed)');
      vdcLines.push('  Shared: leave disabled');
      vdcLines.push('- Click Next');
      vdcLines.push('  External Network Connection: filter for "ext' + (vcg || '<VCG_VLAN>') + '-' + (cust || '<Customer>') + '-' + (sfid || '<SFID>') + '-VCG" and select it');
      vdcLines.push('- Click Next, then Finish');
      vdcLines.push('');
      vdcLines.push('---');
      vdcLines.push('To be continued...');

      const vdcNode = q('#vdc-steps');
      if (vdcNode) vdcNode.textContent = vdcLines.join('\n');
    }

    // ---- Init / wiring ----
    function init() {
      // Input listeners
      ['#custName', '#sfid', '#dc', '#wanVlan', '#vcgVlan', '#cidr'].forEach(sel => {
        const n = document.querySelector(sel);
        if (!n) return;
        ['input', 'change'].forEach(evt => n.addEventListener(evt, compute));
      });

      // Static route: add row
      let staticCount = 1;
      const addBtn = q('#btnAddRoute');
      if (addBtn) addBtn.addEventListener('click', () => {
        staticCount++;
        const row = document.createElement('div');
        row.className = 'field static-row';
        row.innerHTML =
          '<label>Route #' + staticCount + '</label>' +
          '<input class="static-route" placeholder="203.0.113.' + (10 + staticCount) + '/32" />';
        const host = q('#staticRoutes');
        if (host) host.appendChild(row);
      });

      const buildBtn = q('#btnNeedStatic');
      if (buildBtn) buildBtn.addEventListener('click', compute);

      // Arista tabs
      qq('.tab').forEach(t => {
        t.addEventListener('click', () => activateTab(t.getAttribute('data-tab')));
      });

      // Copy buttons
      document.addEventListener('click', e => {
        const btn = e.target && e.target.closest ? e.target.closest('[data-copy]') : null;
        if (!btn) return;
        const id = btn.getAttribute('data-copy');
        const node = document.getElementById(id);
        if (!node) return;
        navigator.clipboard.writeText(node.textContent || '').then(() => {
          const old = btn.textContent;
          btn.textContent = 'Copied';
          setTimeout(() => { btn.textContent = old; }, 900);
        });
      });

      // Local-In page
      const localSel = q('#localInterface');
      if (localSel) {
        localSel.addEventListener('change', e => {
          const useCustom = e.target && e.target.value === 'custom';
          const row = q('#customIntfRow');
          if (row) row.style.display = useCustom ? 'grid' : 'none';
        });
      }
      const genLocal = q('#generateLocal');
      const copyLocal = q('#copyLocal');
      if (genLocal) {
        genLocal.addEventListener('click', () => {
          let intf = (q('#localInterface') && q('#localInterface').value) || 'wan1';
          if (intf === 'custom') {
            const v = (q('#localCustomIntf') && q('#localCustomIntf').value) || '';
            if (v.trim()) intf = v.trim();
          }
          const out = buildLocalInConfig(intf);
          const node = q('#localOutput');
          if (node) node.textContent = out;
        });
      }
      if (copyLocal) {
        copyLocal.addEventListener('click', () => {
          const out = (q('#localOutput') && q('#localOutput').textContent) || '';
          if (!out) return;
          navigator.clipboard.writeText(out);
        });
      }

      // Export / Import wiring
      const expBtn = q('#btnExport');
      if (expBtn) expBtn.addEventListener('click', doExport);
      const impBtn = q('#btnImport');
      const impFile = q('#fileImport');
      if (impBtn) impBtn.addEventListener('click', () => {
        if (impFile) impFile.click();
      });
      if (impFile) {
        impFile.addEventListener('change', e => {
          const f = e && e.target && e.target.files ? e.target.files[0] : null;
          if (f) doImport(f);
          e.target.value = '';
        });
      }

      // Sample and Reset
      const smp = q('#btnSample');
      if (smp) smp.addEventListener('click', () => {
        if (q('#custName')) q('#custName').value = 'NobleGrid Networks';
        if (q('#sfid'))     q('#sfid').value     = '0065x00000AbCdE';
        if (q('#dc'))       q('#dc').value       = 'DAL';
        if (q('#wanVlan'))  q('#wanVlan').value  = '210';
        if (q('#vcgVlan'))  q('#vcgVlan').value  = '1210';
        if (q('#cidr'))     q('#cidr').value     = '100.100.100.1/31';
        compute();
      });

      const rst = q('#btnReset');
      if (rst) rst.addEventListener('click', () => {
        ['#custName', '#sfid', '#wanVlan', '#vcgVlan', '#cidr'].forEach(sel => {
          const n = q(sel); if (n) n.value = '';
        });
        const dcSel = q('#dc'); if (dcSel) dcSel.value = '';
        qq('.static-route').forEach((n, i) => {
          if (i === 0) { n.value = ''; }
          else if (n.parentElement) { n.parentElement.remove(); }
        });
        compute();
      });

      // Router wiring
      document.addEventListener('click', e => {
        const a = e.target.closest && e.target.closest('a[data-route]');
        if (!a) return;
        e.preventDefault();
        const href = a.getAttribute('href') || '#home';
        if (location.hash !== href) {
          try {
            history.pushState(null, '', href);
          } catch (_) {
            location.hash = href;
          }
        }
        showPageFromHash();
      });
      window.addEventListener('popstate', showPageFromHash);
      window.addEventListener('hashchange', showPageFromHash);

      showPageFromHash();
      activateTab('all');
      compute();
      showOK('Ready ✔');
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        try { init(); } catch (e) { showErr('Init failed: ' + e.message); }
      });
    } else {
      try { init(); } catch (e) { showErr('Init failed: ' + e.message); }
    }
  </script>
</body>
</html>
